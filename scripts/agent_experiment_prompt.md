# Zero-trust agent experiment prompt — Thiele law proofpacks

_Last reviewed and verified against `work` branch on 2025-10-29 (UTC)._ 

This prompt encodes the full zero-trust workflow for producing execution-backed
proofpacks that recover the Thiele Law of Compositional Information and its
constituent physical limits. Every statement below has been re-verified in this
workspace so that implementers can trust the documented repository state.

## 1. Verified repository snapshot

| Check | Command | Result (2025-10-29) |
| --- | --- | --- |
| Verifier entry points present | `ls verifier` | `check_cwd.py`, `check_einstein.py`, `check_landauer.py` plus historical JSON outputs. |
| Experiments package absent pre-scaffold | `find . -maxdepth 1 -type d -name 'experiments'` | No hits (we create scaffolding in §9.1). |
| Ledger integration guide exists | `test -f scripts/integration_instructions.md` | Succeeds. |
| No committed simulation artifacts | `ls results plots reports` | Fails as expected (directories absent). |
| Repo timestamp | `date -u` | `Wed Oct 29 08:24:09 UTC 2025`. |

## 2. Zero-trust workflow overview

- **Objective:** Deliver reproducible proofpacks that emit a single `THIELE_OK`
  verdict when audited with deterministic verifiers.
- **Roles:**
  1. **Builder** – implement simulation modules exactly as specified.
  2. **Auditor** – recompute all metrics and fail on any mismatch.
  3. **Falsifier** – craft adversarial ablations to break false structure.
  4. **Archivist** – seal receipts, manifests, hashes, and human summaries.
- **Global guardrails:** deterministic seeds, fixed Ed25519 key per run tag,
  normalized SVG metadata, log-space combinatorics, double precision numerics,
  explicit tolerances, no hidden state, no network or dynamic code generation.
- **Single verdict policy:** any failed check aborts with non-zero exit; do not
  continue subsequent phases until the current phase is green.

## 3. Authoritative source references

- μ-ledger conservation: [`coq/kernel/MuLedgerConservation.v`](coq/kernel/MuLedgerConservation.v)
- VM step semantics: [`coq/kernel/VMStep.v`](coq/kernel/VMStep.v)
- VM state definition: [`coq/kernel/VMState.v`](coq/kernel/VMState.v)
- Ledger integration guidance: [`scripts/integration_instructions.md`](scripts/integration_instructions.md)
- Verifier scripts:
  - Landauer: [`verifier/check_landauer.py`](verifier/check_landauer.py)
  - Einstein–Smoluchowski: [`verifier/check_einstein.py`](verifier/check_einstein.py)
  - CWD: [`verifier/check_cwd.py`](verifier/check_cwd.py)

## 4. Global defaults and tolerances

- RNG seeds: `[0, 1, 2, 3, 4]`
- Trials per condition: `50`
- Temperature grid `T`: `[0.5, 1.0, 2.0]`
- Force magnitudes for Einstein runs: `[0.0, 0.1]`
- Tolerances: `epsilon = 0.05`, `delta = 0.05`, `eta = 0.05`
- Boltzmann constant: `k_B = 1`
- Confidence bands: use bootstrap or analytic CIs with explicit seeds and
  record them in the CSV outputs for the auditors.

## 5. Artifact layout (post-implementation)

```
experiments/               # Python package with runners and utilities
  __init__.py
  ledger_io.py
  configs/
  data/
results/<phase>/<run_tag>/ # CSVs and intermediate diagnostics
plots/<phase>/<run_tag>/   # SVG/PNG with normalized metadata
reports/<phase>_report.md  # Short narrative linking verifiers and plots
verifier/*.json            # Generated by check_* scripts (archived but not trusted)
artifacts/experiments/<timestamp>/manifest.json
```

Generated plots and large artifacts remain uncommitted; only code, configs, and
small deterministic fixtures enter version control.

## 6. Phase charter and acceptance criteria

For each phase, the Builder produces deterministic logs, the Auditor validates
metrics, the Falsifier attacks the claims, and the Archivist packages successful
runs. All tolerances inherit from §4 unless otherwise stated.

### Phase A — Known laws (Landauer, Einstein relation, entropy identity)

#### A1. Landauer (bit erasure surrogate)
- **Builder deliverables:** `experiments/run_landauer.py`, `experiments/configs/landauer.py`,
  CSV schema `seed,T,trial_id,protocol,sum_mu_bits,work,work_over_kTln2`, ledger taps, and
  quick-look plots (`work_vs_mu.svg`, `mu_hist.svg`). Support `--protocol` and
  `--synthetic-ledger` flags; implement Metropolis kernel over a four-state
  Ising surrogate.
- **Auditor checks:**
  \[\big|\tfrac{\langle W\rangle}{k_B T \ln 2}-\sum \mu_{\text{answer}}\big| \le \epsilon\]
  per protocol and temperature. Ensure CSV aggregates match recomputation from
  raw step logs. Confirm byte-stable reruns.
- **Falsifier battery:** Randomize control policy (destroy composition cues) –
  expect minimality failure yet conservation holds; auditor must flag minimality
  but accept conservation.

#### A2. Einstein relation (diffusion–mobility)
- **Builder deliverables:** `experiments/run_einstein.py`, CLI for walkers,
  steps, forces, sampling cadence; logs `seed,T,F,steps,sample_stride,D_est,mu_mech_est,D_minus_mu_kT`.
- **Auditor checks:** Assert `D ≈ μ_mech · k_B · T` across temperatures, blind
  vs sighted AIC comparison (ΔAIC ≥ 10 for exponential vs polynomial cost), and
  slope CIs containing zero for μ/Unit.
- **Falsifier battery:** scramble walker steps or drift labels to ensure verifier
  rejects mismatched scaling while tolerating conservation-only cases.

#### A3. Entropy identity (diffusion protocol)
- **Builder deliverables:** extension of A2 runner logging per-step μ_answer and
  entropy deltas; cumulative series in CSV.
- **Auditor checks:** Theil–Sen slope of ΔS vs μ_answer ≈ 1 with CI covering 1;
  intercept ≈ 0; Spearman ρ ≥ 0.9 with p ≤ 1e-6 for sighted and blind variants.
- **Falsifier battery:** coarse-grain scramble mid-run must break conservation
  proof and lead to verifier failure.

### Phase B — New law: Compositional Work Decomposition (CWD)
- **Builder deliverables:** `experiments/run_cwd.py` producing multi-module
  μ-ledger captures with module IDs, policy actions, success flags, penalty bits,
  and cumulative work taps; summary CSV reporting `mu_total_bits`, `work`,
  `penalty_bits_total`, and `mutual_information_bits`; deterministic fixtures in
  `experiments/data/sample_cwd.jsonl` for replay.
- **Auditor checks:** sighted decomposition equality within ε; penalty bound
  `⟨W⟩_blind - ⟨W⟩_sighted ≥ k_B T ln 2 · I(Module; Policy)` within η using the
  logged mutual-information diagnostics; rerun parity and ledger digests.
- **Falsifier battery:** remove routing labels so penalty collapses and equality
  fails as expected.

### Phase C — Cross-domain echoes
- **Builder deliverables:** compression and LDPC microbenchmarks with
  sighted/blind/destroyed variants, logging μ and runtime; CLI toggles for
  ledger injection.
- **Auditor checks:** sighted slope CI includes 0; blind exponential behavior
  with ΔAIC ≥ 10; destroyed control matches degraded expectations.
- **Falsifier battery:** structure ablations cause auditor to flag failures.

### Phase D — Proofpack & verifier
- **Archivist deliverables:** `protocol.json`, `summary.json`, ledger CSVs,
  plots, manifests with SHA-256 digests, Ed25519 signatures, receipts.
- **Auditor deliverable:** `tools/thiele_verifier.py <dir>` recomputes metrics
  solely from CSVs, enforces thresholds, checks deterministic reruns, verifies
  digests, and prints `THIELE_OK` on success.

### Phase E — Red-team battery
- **Falsifier runs:** structure ablation (advantage collapses), coarse-grain
  scramble mid-run (conservation proof fails), worst-order schedule (blind stays
  exponential; sighted near-flat).
- **Auditor expectation:** any deviation triggers non-zero exit.

## 7. Role handoff rules

1. Builders must deposit artifacts in a dedicated run directory with a
   `RUN_TAG` used by subsequent roles.
2. Auditors rerun builders’ commands with identical seeds; discrepancies require
   builder fixes before proceeding.
3. Falsifiers clone the builder outputs into `artifacts/red_team/<RUN_TAG>/` and
   document the perturbations they apply.
4. Archivists only process directories that passed both auditing and falsifier
   gates, recording manifests and summaries for posterity.

## 8. Implementation backlog

| ID | Task | Role | Status |
| --- | --- | --- | --- |
| 8.1 | Scaffold `experiments/` package and document structure | Builder | ✅ 2025-10-29: Package scaffolding + README. |
| 8.2 | Implement ledger adapter utilities (`experiments/ledger_io.py`) | Builder | ✅ 2025-10-29: JSONL helpers + tests. |
| 8.3 | Landauer runner + smoke tests | Builder/Auditor | ✅ 2025-10-29: Deterministic Metropolis surrogate + pytest coverage. |
| 8.4 | Einstein runner + mobility estimator | Builder/Auditor | ✅ 2025-10-29: Biased diffusion builder with ledger + pytest checks. |
| 8.5 | Entropy identity extensions | Builder/Auditor | ✅ 2025-10-29: Entropy runner + cumulative series + pytest harness. |
| 8.6 | CWD runner + MI estimator | Builder/Auditor | ✅ 2025-10-29: Phase B1 multi-module builder, summary CSV, pytest coverage. |
| 8.7 | Cross-domain echoes suite | Builder/Auditor | ✅ 2025-10-29: Cross-domain runner + fixtures + pytest coverage. |
| 8.8 | Phase A–C verifier harness refresh (`verifier/check_*.py`) | Auditor | ✅ 2025-10-29: Landauer/Einstein/Entropy/CWD/Cross-domain auditors recompute metrics from ledgers. |
| 8.9 | Unified verifier (`tools/thiele_verifier.py`) | Auditor | ✅ 2025-10-29: Aggregated proofpack verifier emits THIELE_OK verdicts. |
| 8.10 | Proofpack manifests and receipts | Archivist | ✅ 2025-10-29: Manifest writer, receipt signer, and pytest coverage. |
| 8.11 | Red-team adversarial scripts | Falsifier | ✅ 2025-10-29: Deterministic attacks + verifier regression tests. |
| 8.12 | Proofpack bundler CLI | Archivist | ✅ 2025-10-29: Added `tools/proofpack_bundler.py` with CLI + regression coverage. |
| 8.13 | Archivist–falsifier integration smoke tests | Auditor/Archivist | ✅ 2025-10-29: Bundler now rejects red-team failures and documents workflow. |
| 8.14 | Byte-stability regression audit | Archivist | ✅ 2025-10-29: Added deterministic manifest/receipt replay tests. |
| 9.1 | End-to-end proofpack orchestration | Orchestrator | ✅ 2025-10-29: Added `scripts/run_proofpack_pipeline.py` with quick profile and pipeline regression test. |
| 9.2 | Human summary narrative generator | Archivist | ✅ 2025-10-29: Added Markdown renderer + bundler integration with summary.md output. |
| 9.3 | Artifact layout enforcement | Archivist | ✅ 2025-10-29: Bundler enforces `artifacts/experiments/<tag>/` roots and new tests cover the guardrail. |
| 9.4 | Public-data candidate discovery | Discovery | ✅ 2025-10-29: Added OSF, Figshare, Dryad, and Zenodo clients plus unified CLI/fixtures to enumerate runbook-aligned raw-data candidates. |
| 9.5 | Anchor extraction + download automation | Discovery | ✅ 2025-10-29: Added anchor regex parsers, filtering CLI, and deterministic download/manifest tooling. |
| 9.6 | Public SPT diffusion analytics | Builder/Auditor | ✅ 2025-10-29: Added `experiments/public_data/spt_analysis.py`, fixtures, and pytest coverage for anchored diffusion/OOS diagnostics. |
| 9.7 | Public SPT proofpack runner & verifier integration | Builder/Auditor | ✅ 2025-10-29: Added `experiments/public_data/spt_protocol.py`, CLI runner, verifier hook, and regression tests for proofpack + ΔAIC/OOS thresholds. |
| 9.8 | Public-data pipeline integration | Orchestrator | ✅ 2025-10-29: Extended `scripts/run_proofpack_pipeline.py` to auto-run mirrored public datasets and bundle verifier payloads. |
| 9.9 | Configurable pipeline profiles | Orchestrator | ✅ 2025-10-29: Added JSON/YAML profile loader, CLI flag, and regression coverage for custom argument grids. |
| 9.10 | Proofpack smoke automation | Orchestrator | ✅ 2025-10-29: Added `make proofpack-smoke`, scheduled CI job, and coverage capturing manifest digests in Actions summaries. |
| 9.11 | Human summary highlights & plot bundling | Archivist | ✅ 2025-10-29: Rendered phase-specific metrics in `render_human_summary` and bundled deterministic public-data SVG diagnostics. |
| 9.12 | Public-data workflow CLI | Orchestrator | ✅ 2025-10-29: Added `scripts/run_public_data_workflow.py` to chain discovery, anchoring, mirroring, pipeline execution, and bundling. |
| 9.13 | JHTDB sampling utilities | Discovery | ✅ 2025-10-29: Added REST sampling helper, CLI bundler, and regression tests for turbulence trajectories. |
| 9.14 | Turbulence proofpack builder & verifier | Builder/Auditor | ✅ 2025-10-29: Added turbulence protocol runner, verifier integration, and pipeline automation with regression coverage. |

## 9. Immediate next actions

1. **Configurable turbulence allowlist** – load dataset slugs from a profile or config file so new JHTDB mirrors can be registered without modifying code.
2. **Digest history automation** – persist the CI smoke digest summary as a rolling JSON artifact for downstream dashboards.
3. **Expanded turbulence coverage** – mirror additional JHTDB budgets (e.g., higher resolution or alternate fields) and record their verifier highlights in `RESULTS.md`.

## 10. Reporting and archival requirements

- Reports must include overview, parameter table, verification summary, plots,
  and ledger sanity checks with links to the regenerated CSVs.
- Archive raw CSVs, plots, verifier JSON, manifests, and signatures under
  `artifacts/experiments/<experiment>/<timestamp>/` for auditability.
- Keep large numerical outputs ephemeral; only deterministic code and small
  fixtures enter the repository.

## 11. Progress log (running)

- 2025-10-29 08:24 UTC: Verified repository state (see §1 table) and
  scaffolded the `experiments/` package with documentation to enable Phase A
  builders.
- 2025-10-29 08:33 UTC: Implemented deterministic ledger IO helpers with test
  coverage, unblocking Phase A runners and providing reusable hashing utilities
  for auditors and archivists.
- 2025-10-29 08:45 UTC: Delivered Phase A builder suite (Landauer, Einstein,
  entropy) with deterministic fixtures, documentation updates, and pytest
  coverage.
- 2025-10-29 08:54 UTC: Implemented Phase B1 CWD builder with MI diagnostics,
  protocol toggles, fixtures, and targeted tests to unblock auditor development.
- 2025-10-29 09:12 UTC: Completed the Phase A1 Landauer runner (`experiments/run_landauer.py`),
  added CLI artefact writers, synthetic replay mode, and pytest coverage ensuring
  μ-ledger equality checks hold across deterministic runs.
- 2025-10-29 10:05 UTC: Implemented the Phase A2 Einstein biased diffusion
  runner (`experiments/run_einstein.py`) with deterministic force schedules,
  ledger aggregation helpers, CLI writers, and pytest coverage validating the
  Einstein relation across replayed and simulated trials.
- 2025-10-29 11:02 UTC: Delivered the Phase A3 entropy identity runner
  (`experiments/run_entropy.py`) with μ/entropy ledger pairs, cumulative
  series CSV, synthetic replay fixture, and pytest coverage for reproducible
  slopes and correlation diagnostics.
- 2025-10-29 11:48 UTC: Delivered the Phase C cross-domain echoes builder
  (`experiments/run_cross_domain.py`) with deterministic compression/LDPC
  surrogates, fixtures, documentation, and pytest coverage exercising sighted,
  blind, destroyed, and synthetic replay protocols.
- 2025-10-29 12:15 UTC: Added Phase A–C auditor harnesses (`verifier/check_*.py`) and regression tests that recompute metrics from μ-ledgers, enforce tolerances, and validate metadata digests for Landauer, Einstein, entropy, CWD, and cross-domain outputs.
- 2025-10-29 12:34 UTC: Completed the unified proofpack verifier (`tools/thiele_verifier.py`) with aggregated JSON output, CLI wiring, and regression tests that emit a single THIELE_OK verdict across phases A–C, B1, and C.
- 2025-10-29 13:05 UTC: Added archivist helpers (`experiments/proofpack.py`) with manifest, summary, and receipt writers plus pytest coverage for manifest/receipt validation.
- 2025-10-29 13:22 UTC: Implemented deterministic red-team perturbations (`experiments/red_team.py`) and regression tests that ensure the verifiers fail on structure ablation, entropy scrambles, and penalty collapse scenarios.
- 2025-10-29 13:48 UTC: Implemented `tools/proofpack_bundler.py`, wired it into the archivist workflow, and documented CLI usage in `experiments/README.md`.
- 2025-10-29 13:55 UTC: Added integration tests linking red-team perturbations to the bundler failure path and introduced byte-stability regression coverage for manifests and receipts.
- 2025-10-29 14:32 UTC: Delivered the end-to-end proofpack pipeline script, enforced canonical artifact layout, generated Markdown human summaries, and added regression coverage across bundler and pipeline entry points.
- 2025-10-29 15:10 UTC: Wired the turbulence proofpack runner and verifier into the pipeline, extended the unified verifier highlights, and automated RESULTS.md digest updates for the proofpack smoke workflow.
- 2025-10-29 15:05 UTC: Implemented OSF candidate discovery (`experiments/data_sources/osf.py`, `scripts/discover_osf_candidates.py`) with deterministic queries, grouping logic, and pytest coverage; next step is metadata anchor extraction before downloads.
- 2025-10-29 15:47 UTC: Extended public-data discovery to Figshare, Dryad, and Zenodo, added a unified CLI (`scripts/discover_public_candidates.py`), and committed fixtures + pytest coverage for each repository client.
- 2025-10-29 16:22 UTC: Implemented metadata anchor extraction utilities (`experiments/data_sources/anchors.py`) and the filtering CLI (`scripts/filter_public_candidates.py`) with pytest coverage and documentation updates.
- 2025-10-29 16:58 UTC: Added deterministic download/manifest utilities (`experiments/data_sources/download.py`, `scripts/download_public_files.py`) with fixtures, regression tests, and README/prompt updates documenting the mirrored dataset workflow.
- 2025-10-29 17:24 UTC: Delivered public single-particle tracking analytics (`experiments/public_data/spt_analysis.py`) with anchored Stokes predictions, out-of-sample diagnostics, fixtures, and updated documentation connecting the module to the public-data runbook.
- 2025-10-29 18:03 UTC: Delivered the public SPT proofpack runner (`experiments/public_data/spt_protocol.py` + CLI), wired it into the unified verifier, and added regression coverage for ΔAIC, Spearman/p-value thresholds, and OOS error checks.
- 2025-10-29 18:44 UTC: Extended `scripts/run_proofpack_pipeline.py` to sweep mirrored public datasets, pipe results through the unified verifier, and documented the integrated public-data workflow with regression coverage.
 - 2025-10-29 18:58 UTC: Added turbulence protocol/seed selectors to the pipeline and public-data workflow CLIs with regression coverage ensuring subset executions respect the new flags.
 - 2025-10-29 19:06 UTC: Mirrored additional JHTDB fixtures, backfilled `RESULTS.md` smoke digests, and documented sampling budgets plus verifier highlight updates.
 - 2025-10-29 20:45 UTC: Added turbulence dataset allowlists, digest-history summaries, and scheduled high-budget runs with documentation, CI automation, and RESULTS updates capturing turbulence runtime and penalty highlights.
- Future contributors must append dated entries summarizing concrete execution
  or verification steps, including command traces and resulting run tags.
