[
  {
    "step": 2,
    "instruction": {
      "op": "PNEW",
      "payload": [
        1,
        2
      ]
    },
    "pre_state": {
      "pc": 0,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "post_state": {
      "pc": 1,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "observation": {
      "event": {
        "tag": "InferenceComplete"
      },
      "mu_delta": 0,
      "cert": {
        "smt_query": "",
        "solver_reply": "",
        "metadata": "",
        "timestamp": 0,
        "sequence": 0
      }
    },
    "pre_state_hash": "3be4ab3e30347c3b36b3c176e39c564d8b2e1e6c6f816f53070d67ed3cd381f4",
    "post_state_hash": "2e59cea3b3cf0e0427b5d1025581d2f165a69235777b0cabab6bdd7773234376",
    "signature": "5975d6d5ced2dcd583ddbd10049ac4885905eada34b85bbafdb6e760fa6c602a87d8c9d9bb2cfeffdb655f8acb59183173cab7ef5de200c9373477c4f8249709"
  },
  {
    "step": 4,
    "instruction": {
      "op": "PYEXEC",
      "payload": "\nimport json\nimport random\n\nstrategy = 'pr'\nseed = int(1337)\nrandom.seed(seed)\n\nn_per_setting = int(500)\n\n# Supra-quantum 16/5 distribution used in demos/demo_chsh_game.py\nSUPRA_PROBS = {\n    # (x, y, a, b): (numerator, denominator)\n    (0, 0, 0, 0): (1, 5),\n    (0, 0, 1, 1): (1, 5),\n    (0, 0, 0, 1): (3, 10),\n    (0, 0, 1, 0): (3, 10),\n\n    (0, 1, 0, 0): (1, 2),\n    (0, 1, 1, 1): (1, 2),\n    (0, 1, 0, 1): (0, 1),\n    (0, 1, 1, 0): (0, 1),\n\n    (1, 0, 0, 0): (1, 2),\n    (1, 0, 1, 1): (1, 2),\n    (1, 0, 0, 1): (0, 1),\n    (1, 0, 1, 0): (0, 1),\n\n    (1, 1, 0, 0): (1, 2),\n    (1, 1, 1, 1): (1, 2),\n    (1, 1, 0, 1): (0, 1),\n    (1, 1, 1, 0): (0, 1),\n}\n\nTSIRELSON_GAMMA = 7071 / 10000  # matches tools/make_bell_receipt.py\n\n\ndef _sample_from_probs(x, y):\n    outcomes = [(0,0),(0,1),(1,0),(1,1)]\n    weights = []\n    for a, b in outcomes:\n        num, denom = SUPRA_PROBS.get((x, y, a, b), (0, 1))\n        weights.append(float(num) / float(denom))\n    total = sum(weights)\n    if total <= 0:\n        return (0, 0)\n    r = random.random() * total\n    acc = 0.0\n    for (a, b), w in zip(outcomes, weights):\n        acc += w\n        if r <= acc:\n            return (a, b)\n    return outcomes[-1]\n\n\ndef _sample_tsirelson(x, y):\n    # Construct a distribution from correlator expectation only.\n    # For this repo's CHSH convention, a Tsirelson-style witness uses\n    # E(0,0) = -gamma and E(x,y)=+gamma otherwise so that:\n    #   S = E11 + E10 + E01 - E00 = gamma + gamma + gamma - (-gamma) = 4*gamma.\n    expectation = -TSIRELSON_GAMMA if (x == 0 and y == 0) else TSIRELSON_GAMMA\n    p_same = 0.5 + expectation / 2.0\n    a = random.randint(0, 1)\n    if random.random() < p_same:\n        b = a\n    else:\n        b = 1 - a\n    return (a, b)\n\n\ndef _sample_pr_repo_convention(x, y):\n    # PR-like box for the repo's CHSH convention:\n    # anti-correlated at (0,0), correlated elsewhere.\n    a = random.randint(0, 1)\n    if x == 0 and y == 0:\n        b = 1 - a\n    else:\n        b = a\n    return (a, b)\n\n\ndef sample_outcome(x, y):\n    if strategy == \"lhv\":\n        return (0, 0)\n    if strategy == \"supra_16_5\":\n        return _sample_from_probs(x, y)\n    if strategy == \"tsirelson\":\n        return _sample_tsirelson(x, y)\n    if strategy == \"pr\":\n        return _sample_pr_repo_convention(x, y)\n    raise RuntimeError(\"unknown strategy\")\n\n\ncounts = {}\nfor x in (0, 1):\n    for y in (0, 1):\n        for _ in range(n_per_setting):\n            a, b = sample_outcome(x, y)\n            key = f\"{x},{y},{a},{b}\"\n            counts[key] = int(counts.get(key, 0)) + 1\n\npayload = {\n    \"n_per_setting\": n_per_setting,\n    \"seed\": seed,\n    \"strategy\": strategy,\n    \"counts\": counts,\n}\n\nwith open('artifacts/bell/operational_runs/20251215_180612/pr/dataset.json', \"w\", encoding=\"utf-8\") as f:\n    json.dump(payload, f, sort_keys=True)\n"
    },
    "pre_state": {
      "pc": 1,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "post_state": {
      "pc": 2,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "observation": {
      "event": {
        "tag": "PolicyCheck",
        "value": "\nimport json\nimport random\n\nstrategy = 'pr'\nseed = int(1337)\nrandom.seed(seed)\n\nn_per_setting = int(500)\n\n# Supra-quantum 16/5 distribution used in demos/demo_chsh_game.py\nSUPRA_PROBS = {\n    # (x, y, a, b): (numerator, denominator)\n    (0, 0, 0, 0): (1, 5),\n    (0, 0, 1, 1): (1, 5),\n    (0, 0, 0, 1): (3, 10),\n    (0, 0, 1, 0): (3, 10),\n\n    (0, 1, 0, 0): (1, 2),\n    (0, 1, 1, 1): (1, 2),\n    (0, 1, 0, 1): (0, 1),\n    (0, 1, 1, 0): (0, 1),\n\n    (1, 0, 0, 0): (1, 2),\n    (1, 0, 1, 1): (1, 2),\n    (1, 0, 0, 1): (0, 1),\n    (1, 0, 1, 0): (0, 1),\n\n    (1, 1, 0, 0): (1, 2),\n    (1, 1, 1, 1): (1, 2),\n    (1, 1, 0, 1): (0, 1),\n    (1, 1, 1, 0): (0, 1),\n}\n\nTSIRELSON_GAMMA = 7071 / 10000  # matches tools/make_bell_receipt.py\n\n\ndef _sample_from_probs(x, y):\n    outcomes = [(0,0),(0,1),(1,0),(1,1)]\n    weights = []\n    for a, b in outcomes:\n        num, denom = SUPRA_PROBS.get((x, y, a, b), (0, 1))\n        weights.append(float(num) / float(denom))\n    total = sum(weights)\n    if total <= 0:\n        return (0, 0)\n    r = random.random() * total\n    acc = 0.0\n    for (a, b), w in zip(outcomes, weights):\n        acc += w\n        if r <= acc:\n            return (a, b)\n    return outcomes[-1]\n\n\ndef _sample_tsirelson(x, y):\n    # Construct a distribution from correlator expectation only.\n    # For this repo's CHSH convention, a Tsirelson-style witness uses\n    # E(0,0) = -gamma and E(x,y)=+gamma otherwise so that:\n    #   S = E11 + E10 + E01 - E00 = gamma + gamma + gamma - (-gamma) = 4*gamma.\n    expectation = -TSIRELSON_GAMMA if (x == 0 and y == 0) else TSIRELSON_GAMMA\n    p_same = 0.5 + expectation / 2.0\n    a = random.randint(0, 1)\n    if random.random() < p_same:\n        b = a\n    else:\n        b = 1 - a\n    return (a, b)\n\n\ndef _sample_pr_repo_convention(x, y):\n    # PR-like box for the repo's CHSH convention:\n    # anti-correlated at (0,0), correlated elsewhere.\n    a = random.randint(0, 1)\n    if x == 0 and y == 0:\n        b = 1 - a\n    else:\n        b = a\n    return (a, b)\n\n\ndef sample_outcome(x, y):\n    if strategy == \"lhv\":\n        return (0, 0)\n    if strategy == \"supra_16_5\":\n        return _sample_from_probs(x, y)\n    if strategy == \"tsirelson\":\n        return _sample_tsirelson(x, y)\n    if strategy == \"pr\":\n        return _sample_pr_repo_convention(x, y)\n    raise RuntimeError(\"unknown strategy\")\n\n\ncounts = {}\nfor x in (0, 1):\n    for y in (0, 1):\n        for _ in range(n_per_setting):\n            a, b = sample_outcome(x, y)\n            key = f\"{x},{y},{a},{b}\"\n            counts[key] = int(counts.get(key, 0)) + 1\n\npayload = {\n    \"n_per_setting\": n_per_setting,\n    \"seed\": seed,\n    \"strategy\": strategy,\n    \"counts\": counts,\n}\n\nwith open('artifacts/bell/operational_runs/20251215_180612/pr/dataset.json', \"w\", encoding=\"utf-8\") as f:\n    json.dump(payload, f, sort_keys=True)\n"
      },
      "mu_delta": 0,
      "cert": {
        "smt_query": "",
        "solver_reply": "",
        "metadata": "",
        "timestamp": 0,
        "sequence": 0
      }
    },
    "pre_state_hash": "2e59cea3b3cf0e0427b5d1025581d2f165a69235777b0cabab6bdd7773234376",
    "post_state_hash": "15713ac6773c4903303bd6ba812422142bcbd5b39ba256b43969353ac4f47f59",
    "signature": "2922c4b9a358d6a425cd38541c0c3edc0d8fb018f2033816a45c4e7f306adab56430072877aa4b7ee19085f5159441b17d84ab0576e111876d46952e9292f006"
  },
  {
    "step": 6,
    "instruction": {
      "op": "EMIT",
      "payload": 64
    },
    "pre_state": {
      "pc": 2,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "post_state": {
      "pc": 3,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "observation": {
      "event": {
        "tag": "ErrorOccurred",
        "value": "64"
      },
      "mu_delta": 0,
      "cert": {
        "smt_query": "",
        "solver_reply": "",
        "metadata": "",
        "timestamp": 0,
        "sequence": 0
      }
    },
    "pre_state_hash": "15713ac6773c4903303bd6ba812422142bcbd5b39ba256b43969353ac4f47f59",
    "post_state_hash": "6295c09d07120cab3fa48d4f08d9b07a275c79d0d10d9ba5f2b858f670f25c59",
    "signature": "ef6c3b6a7b07d8e711fbb2d8812faf095d0eda3409d689999739de31f6c290dbef7f97951cfe3f4a76633eba188360303627f23036508f1a24629ec04cf62903"
  },
  {
    "step": 8,
    "instruction": {
      "op": "EMIT",
      "payload": "done"
    },
    "pre_state": {
      "pc": 3,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "post_state": {
      "pc": 4,
      "status": 0,
      "mu_acc": 0,
      "cert_addr": ""
    },
    "observation": {
      "event": {
        "tag": "ErrorOccurred",
        "value": "done"
      },
      "mu_delta": 0,
      "cert": {
        "smt_query": "",
        "solver_reply": "",
        "metadata": "",
        "timestamp": 0,
        "sequence": 0
      }
    },
    "pre_state_hash": "6295c09d07120cab3fa48d4f08d9b07a275c79d0d10d9ba5f2b858f670f25c59",
    "post_state_hash": "700da4c068b172264a4f0599d5bb6e22ef3321e4c9967d4430c31cefb17ce59d",
    "signature": "09f12fb290f431beeb4edc9ba00b1211a5af87381a82df182657e612911bae72cf2c4f12d9feab813a6b35a0c6b777c2845b2e8cd239890092fb8ac89b2ecd00"
  }
]