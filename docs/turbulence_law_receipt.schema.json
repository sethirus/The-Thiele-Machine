{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Turbulence law receipt summary",
  "type": "object",
  "required": [
    "event",
    "generator",
    "nusd",
    "aggregate",
    "training_evaluations",
    "evaluation_evaluations",
    "chain_validation",
    "crypto_hash",
    "signature",
    "signature_algorithm"
  ],
  "properties": {
    "event": {"const": "turbulence_law_summary"},
    "generator": {
      "type": "object",
      "required": ["script", "sha256", "parameters"],
      "properties": {
        "script": {"const": "tools/make_turbulence_law_receipt.py"},
        "sha256": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
        "parameters": {
          "type": "object",
          "required": ["samples", "max_terms", "temperature", "epsilon_bits", "blind_bits_per_sample"],
          "properties": {
            "samples": {"type": "integer", "minimum": 4},
            "max_terms": {"type": "integer", "minimum": 1},
            "temperature": {"type": "number"},
            "epsilon_bits": {"type": "number"},
            "blind_bits_per_sample": {"type": "number", "exclusiveMinimum": 0}
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "nusd": {
      "type": "object",
      "required": [
        "mu_question_bits",
        "mu_answer_bits",
        "mu_total_bits",
        "mu_gap_vs_blind_bits",
        "mu_gap_vs_ar1_bits",
        "aggregate_residual_bits",
        "aggregate_baseline_bits",
        "aggregate_delta_bits",
        "aggregate_ar1_total_bits",
        "aggregate_blind_total_bits",
        "epsilon_bits",
        "temperature_kelvin",
        "samples_per_series",
        "training_seeds",
        "evaluation_seeds",
        "blind_bits_per_sample"
      ],
      "properties": {
        "mu_question_bits": {"type": "number"},
        "mu_answer_bits": {"type": "number"},
        "mu_total_bits": {"type": "number"},
        "mu_gap_vs_blind_bits": {"type": "number"},
        "mu_gap_vs_ar1_bits": {"type": "number"},
        "aggregate_residual_bits": {"type": "number"},
        "aggregate_baseline_bits": {"type": "number"},
        "aggregate_delta_bits": {"type": "number"},
        "aggregate_ar1_total_bits": {"type": "number"},
        "aggregate_blind_total_bits": {"type": "number"},
        "epsilon_bits": {"type": "number"},
        "temperature_kelvin": {"type": "number"},
        "samples_per_series": {"type": "integer", "minimum": 4},
        "training_seeds": {"type": "array", "items": {"type": "integer"}},
        "evaluation_seeds": {"type": "array", "items": {"type": "integer"}},
        "evaluation_datasets": {"type": "array", "items": {"type": "string"}},
        "blind_bits_per_sample": {"type": "number", "exclusiveMinimum": 0}
      },
      "additionalProperties": true
    },
    "training_evaluations": {
      "type": "array",
      "items": {"$ref": "#/definitions/evaluation"}
    },
    "evaluation_evaluations": {
      "type": "array",
      "items": {"$ref": "#/definitions/evaluation"}
    },
    "aggregate": {
      "type": "object",
      "required": ["series", "samples", "digest"],
      "properties": {
        "series": {"type": "string"},
        "samples": {"type": "integer", "minimum": 4},
        "digest": {"type": "string", "pattern": "^[0-9a-f]{64}$"}
      },
      "additionalProperties": false
    },
    "chain_validation": {
      "type": "object",
      "required": ["entries", "self_check"],
      "properties": {
        "entries": {"type": "integer", "minimum": 1},
        "self_check": {"const": true}
      },
      "additionalProperties": false
    },
    "crypto_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
    "signature": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
    "signature_algorithm": {"const": "HMAC-SHA256"}
  },
  "additionalProperties": true,
  "definitions": {
    "evaluation": {
      "type": "object",
      "required": ["series", "residual_bits", "baseline_bits", "delta_vs_baseline", "ar1_total_bits", "blind_total_bits"],
      "properties": {
        "series": {"type": "string"},
        "residual_bits": {"type": "number"},
        "baseline_bits": {"type": "number"},
        "delta_vs_baseline": {"type": "number"},
        "ar1_total_bits": {"type": "number"},
        "blind_total_bits": {"type": "number"}
      },
      "additionalProperties": false
    }
  }
}
