{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Turbulence head-to-head receipt summary",
  "type": "object",
  "required": [
    "event",
    "generator",
    "dataset",
    "solvers",
    "temperature_kelvin",
    "epsilon_bits",
    "mu_gap_bits",
    "chain_validation",
    "crypto_hash",
    "signature",
    "signature_algorithm"
  ],
  "properties": {
    "event": {
      "const": "turbulence_head_to_head_summary"
    },
    "generator": {
      "type": "object",
      "required": ["script", "sha256", "parameters"],
      "properties": {
        "script": {"const": "tools/make_turbulence_head_to_head.py"},
        "sha256": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
        "parameters": {
          "type": "object",
          "required": ["seed", "samples", "grid", "temperature", "epsilon_bits", "blind_bits_per_sample"],
          "properties": {
            "seed": {"type": "integer"},
            "samples": {"type": "integer", "minimum": 2},
            "grid": {"type": "integer", "minimum": 1},
            "temperature": {"type": "number"},
            "epsilon_bits": {"type": "number"},
            "blind_bits_per_sample": {"type": "number", "exclusiveMinimum": 0}
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "dataset": {
      "type": "object",
      "required": ["series_sha256", "samples", "grid", "seed", "energy_mean", "energy_variance", "baseline_energy", "baseline_bits"],
      "properties": {
        "series_sha256": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
        "samples": {"type": "integer", "minimum": 2},
        "grid": {"type": "integer", "minimum": 1},
        "seed": {"type": "integer"},
        "energy_mean": {"type": "number"},
        "energy_variance": {"type": "number"},
        "baseline_energy": {"type": "number"},
        "baseline_bits": {"type": "number"}
      },
      "additionalProperties": false
    },
    "solvers": {
      "type": "object",
      "required": ["sighted", "blind"],
      "properties": {
        "sighted": {"$ref": "#/definitions/solverBlock"},
        "blind": {"$ref": "#/definitions/solverBlock"}
      },
      "additionalProperties": false
    },
    "temperature_kelvin": {"type": "number"},
    "epsilon_bits": {"type": "number"},
    "calibration_dataset": {"type": ["string", "null"]},
    "mu_gap_bits": {"type": "number"},
    "chain_validation": {
      "type": "object",
      "required": ["entries", "self_check"],
      "properties": {
        "entries": {"type": "integer", "minimum": 1},
        "self_check": {"const": true}
      },
      "additionalProperties": false
    },
    "crypto_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
    "signature": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
    "signature_algorithm": {"const": "HMAC-SHA256"}
  },
  "additionalProperties": true,
  "definitions": {
    "solverBlock": {
      "type": "object",
      "required": ["mdl_bits", "nusd_bound", "detail"],
      "properties": {
        "mdl_bits": {"$ref": "#/definitions/mdl"},
        "nusd_bound": {"$ref": "#/definitions/nusd"},
        "detail": {"type": "object"}
      },
      "additionalProperties": true
    },
    "mdl": {
      "type": "object",
      "required": ["model_bits", "residual_bits", "baseline_bits", "total_bits", "delta_vs_baseline"],
      "properties": {
        "model_bits": {"type": "number"},
        "residual_bits": {"type": "number"},
        "baseline_bits": {"type": "number"},
        "total_bits": {"type": "number"},
        "delta_vs_baseline": {"type": "number"}
      },
      "additionalProperties": false
    },
    "nusd": {
      "type": "object",
      "required": [
        "mu_question_bits",
        "mu_answer_bits",
        "epsilon_bits",
        "mu_total_bits",
        "landauer_work_bound_joules",
        "landauer_factor_j_per_bit"
      ],
      "properties": {
        "mu_question_bits": {"type": "number"},
        "mu_answer_bits": {"type": "number"},
        "epsilon_bits": {"type": "number"},
        "mu_total_bits": {"type": "number"},
        "landauer_work_bound_joules": {"type": "number"},
        "landauer_factor_j_per_bit": {"type": "number"},
        "calibrated_mu_bits": {"type": "number"},
        "calibrated_work_joules": {"type": "number"}
      },
      "additionalProperties": true
    }
  }
}
