{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Law Receipt Entry",
  "description": "Schema for entries produced by tools/make_law_receipt.py",
  "oneOf": [
    {
      "type": "object",
      "required": ["event", "t", "values", "previous_hash", "crypto_hash"],
      "properties": {
        "event": {"const": "time_slice"},
        "t": {"type": "integer", "minimum": 0},
        "values": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["numerator", "denominator"],
            "properties": {
              "numerator": {"type": "integer"},
              "denominator": {"type": "integer", "minimum": 1}
            },
            "additionalProperties": false
          }
        },
        "previous_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
        "crypto_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"}
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": [
        "event",
        "generator",
        "lattice",
        "coefficients",
        "conservation",
        "recursion",
        "polynomials",
        "mdl_bits",
        "nusd_bound",
        "trace",
        "coq_check",
        "chain_validation",
        "previous_hash",
        "crypto_hash",
        "signature"
      ],
      "properties": {
        "event": {"const": "law_summary"},
        "generator": {"type": "object"},
        "lattice": {
          "type": "object",
          "required": ["sites", "time_slices"],
          "properties": {
            "sites": {"type": "integer", "minimum": 1},
            "time_slices": {"type": "integer", "minimum": 1}
          },
          "additionalProperties": false
        },
        "coefficients": {"type": "object"},
        "conservation": {"type": "object"},
        "recursion": {"type": "object"},
        "polynomials": {"type": "object"},
        "mdl_bits": {"type": "object"},
        "nusd_bound": {
          "type": "object",
          "required": [
            "boltzmann_constant",
            "ln2",
            "temperature_kelvin",
            "mu_question_bits",
            "mu_answer_bits",
            "epsilon_bits",
            "mu_total_bits",
            "landauer_factor_j_per_bit",
            "landauer_work_bound_joules"
          ],
          "properties": {
            "boltzmann_constant": {"type": "number", "exclusiveMinimum": 0},
            "ln2": {"type": "number", "exclusiveMinimum": 0},
            "temperature_kelvin": {"type": "number", "exclusiveMinimum": 0},
            "mu_question_bits": {"type": "number"},
            "mu_answer_bits": {"type": "number"},
            "epsilon_bits": {"type": "number"},
            "mu_total_bits": {"type": "number"},
            "landauer_factor_j_per_bit": {"type": "number", "exclusiveMinimum": 0},
            "landauer_work_bound_joules": {"type": "number", "minimum": 0},
            "calibrated_mu_bits": {"type": "number"},
            "calibrated_work_joules": {"type": "number", "minimum": 0},
            "calibration": {
              "type": "object",
              "required": [
                "source_path",
                "sha256",
                "sample_count",
                "mean_energy_per_mu_bit_joules",
                "std_energy_per_mu_bit_joules",
                "total_energy_joules",
                "total_mu_bits"
              ],
              "properties": {
                "source_path": {"type": "string"},
                "sha256": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
                "sample_count": {"type": "integer", "minimum": 1},
                "mean_energy_per_mu_bit_joules": {"type": "number", "minimum": 0},
                "std_energy_per_mu_bit_joules": {"type": "number", "minimum": 0},
                "total_energy_joules": {"type": "number", "minimum": 0},
                "total_mu_bits": {"type": "number", "minimum": 0}
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "trace": {"type": "object"},
        "coq_check": {
          "type": "object",
          "required": [
            "harness_path",
            "artifact_hash",
            "artifact_bytes",
            "passed",
            "coq_args"
          ],
          "properties": {
            "harness_path": {"type": "string"},
            "artifact_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
            "artifact_bytes": {"type": "integer", "minimum": 0},
            "passed": {"type": "boolean"},
            "coq_args": {
              "type": "array",
              "items": {"type": "string"}
            }
          },
          "additionalProperties": false
        },
        "chain_validation": {"type": "object"},
        "previous_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
        "crypto_hash": {"type": "string", "pattern": "^[0-9a-f]{64}$"},
        "signature": {"type": "string", "pattern": "^[0-9a-f]{64}$"}
      },
      "additionalProperties": true
    }
  ]
}
